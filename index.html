<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>12ì›” ì¼ì • íˆ¬í‘œ</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 1.8rem;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 25px;
      font-size: 0.9rem;
    }

    .select-section {
      margin-bottom: 25px;
    }

    .select-section label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #444;
    }

    select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      background: white;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.85rem;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .calendar {
      margin-bottom: 25px;
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-bottom: 10px;
    }

    .calendar-header span {
      text-align: center;
      font-weight: 600;
      color: #666;
      font-size: 0.85rem;
      padding: 8px 0;
    }

    .calendar-header span:first-child {
      color: #e74c3c;
    }

    .calendar-header span:last-child {
      color: #3498db;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      background: white;
    }

    .day:hover:not(.empty):not(.past) {
      border-color: #667eea;
      transform: scale(1.05);
    }

    .day.empty {
      border: none;
      cursor: default;
    }

    .day.past {
      background: #f5f5f5;
      color: #bbb;
      cursor: not-allowed;
    }

    .day.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
    }

    .day-number {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .day:nth-child(7n+1) .day-number {
      color: #e74c3c;
    }

    .day:nth-child(7n) .day-number {
      color: #3498db;
    }

    .day.selected .day-number {
      color: white;
    }

    .day.past .day-number {
      color: #bbb !important;
    }

    .votes-container {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      margin-top: 4px;
      justify-content: center;
    }

    .vote-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .btn-container {
      display: flex;
      gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .status {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .status.loading {
      background: #fff3cd;
      color: #856404;
    }

    .config-notice {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 0.85rem;
      color: #856404;
    }

    .config-notice code {
      background: rgba(0,0,0,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“… 12ì›” ì¼ì • íˆ¬í‘œ</h1>
    <p class="subtitle">2025ë…„ 12ì›” - ê°€ëŠ¥í•œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>

    <div class="config-notice" id="configNotice">
      âš ï¸ Supabase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
      ì•„ë˜ ì½”ë“œì—ì„œ <code>SUPABASE_URL</code>ê³¼ <code>SUPABASE_KEY</code>ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
    </div>

    <div class="select-section">
      <label for="personSelect">ğŸ‘¤ ì´ë¦„ ì„ íƒ</label>
      <select id="personSelect">
        <option value="">-- ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš” --</option>
        <option value="ì² ìˆ˜">ì² ìˆ˜</option>
        <option value="ì˜í¬">ì˜í¬</option>
        <option value="ë¯¼ìˆ˜">ë¯¼ìˆ˜</option>
        <option value="ì§€í˜„">ì§€í˜„</option>
        <option value="ë™ìš±">ë™ìš±</option>
      </select>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-dot" style="background: #e74c3c;"></div>
        <span>ì² ìˆ˜</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #3498db;"></div>
        <span>ì˜í¬</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #2ecc71;"></div>
        <span>ë¯¼ìˆ˜</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #f39c12;"></div>
        <span>ì§€í˜„</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #9b59b6;"></div>
        <span>ë™ìš±</span>
      </div>
    </div>

    <div class="calendar">
      <div class="calendar-header">
        <span>ì¼</span>
        <span>ì›”</span>
        <span>í™”</span>
        <span>ìˆ˜</span>
        <span>ëª©</span>
        <span>ê¸ˆ</span>
        <span>í† </span>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div class="btn-container">
      <button class="btn btn-secondary" id="resetBtn">ì´ˆê¸°í™”</button>
      <button class="btn btn-primary" id="saveBtn" disabled>ì €ì¥í•˜ê¸°</button>
    </div>

    <div class="status" id="status" style="display: none;"></div>
  </div>

  <script>
    // ============================================
    // ğŸ”§ ì—¬ê¸°ì— Supabase ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”!
    // ============================================
    const SUPABASE_URL = 'https://xxtebninrfqaptushbvl.supabase.co';      // ì˜ˆ: https://xxxxx.supabase.co
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4dGVibmlucmZxYXB0dXNoYnZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NjA3MTMsImV4cCI6MjA4MDMzNjcxM30.31O2XSAknqlSWjkTOG4cxVnJ4K9MXS8GGDgIMjzfqdo'; // ì˜ˆ: eyJhbGciOiJIUzI1NiIs...
    // ============================================

    // ì‚¬ëŒë³„ ìƒ‰ìƒ
    const COLORS = {
      'ì² ìˆ˜': '#e74c3c',
      'ì˜í¬': '#3498db',
      'ë¯¼ìˆ˜': '#2ecc71',
      'ì§€í˜„': '#f39c12',
      'ë™ìš±': '#9b59b6'
    };

    // ìƒíƒœ
    let supabase = null;
    let selectedDates = [];
    let allVotes = {};
    let currentPerson = '';

    // DOM ìš”ì†Œ
    const personSelect = document.getElementById('personSelect');
    const calendarGrid = document.getElementById('calendarGrid');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');
    const status = document.getElementById('status');
    const configNotice = document.getElementById('configNotice');

    // ì´ˆê¸°í™”
    function init() {
      if (SUPABASE_URL !== 'YOUR_SUPABASE_URL' && SUPABASE_KEY !== 'YOUR_SUPABASE_ANON_KEY') {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        configNotice.style.display = 'none';
        loadAllVotes();
      }
      renderCalendar();
      
      personSelect.addEventListener('change', onPersonChange);
      saveBtn.addEventListener('click', saveVotes);
      resetBtn.addEventListener('click', resetSelection);
    }

    // ë‹¬ë ¥ ë Œë”ë§
    function renderCalendar() {
      calendarGrid.innerHTML = '';
      
      // 2025ë…„ 12ì›” 1ì¼ì€ ì›”ìš”ì¼ (ì‹œì‘ ìš”ì¼: 1)
      const firstDay = 1; // 0=ì¼, 1=ì›”, ...
      const daysInMonth = 31;
      const today = new Date();
      const currentDay = today.getFullYear() === 2025 && today.getMonth() === 11 ? today.getDate() : 0;

      // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'day empty';
        calendarGrid.appendChild(emptyDay);
      }

      // ë‚ ì§œ ì±„ìš°ê¸°
      for (let day = 1; day <= daysInMonth; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        dayEl.dataset.day = day;

        if (day < currentDay) {
          dayEl.classList.add('past');
        }

        // ë‚ ì§œ ìˆ«ì
        const dayNumber = document.createElement('span');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayEl.appendChild(dayNumber);

        // íˆ¬í‘œ í‘œì‹œ ì»¨í…Œì´ë„ˆ
        const votesContainer = document.createElement('div');
        votesContainer.className = 'votes-container';
        dayEl.appendChild(votesContainer);

        // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
        if (selectedDates.includes(day)) {
          dayEl.classList.add('selected');
        }

        // í´ë¦­ ì´ë²¤íŠ¸
        if (day >= currentDay && currentPerson) {
          dayEl.addEventListener('click', () => toggleDate(day));
        }

        calendarGrid.appendChild(dayEl);
      }

      updateVoteDots();
    }

    // íˆ¬í‘œ ì  ì—…ë°ì´íŠ¸
    function updateVoteDots() {
      document.querySelectorAll('.day:not(.empty)').forEach(dayEl => {
        const day = parseInt(dayEl.dataset.day);
        const votesContainer = dayEl.querySelector('.votes-container');
        votesContainer.innerHTML = '';

        Object.entries(allVotes).forEach(([person, dates]) => {
          if (dates.includes(day) && person !== currentPerson) {
            const dot = document.createElement('div');
            dot.className = 'vote-dot';
            dot.style.background = COLORS[person];
            dot.title = person;
            votesContainer.appendChild(dot);
          }
        });
      });
    }

    // ë‚ ì§œ í† ê¸€
    function toggleDate(day) {
      if (!currentPerson) return;

      const index = selectedDates.indexOf(day);
      if (index > -1) {
        selectedDates.splice(index, 1);
      } else {
        selectedDates.push(day);
      }
      selectedDates.sort((a, b) => a - b);
      
      renderCalendar();
      saveBtn.disabled = false;
    }

    // ì‚¬ëŒ ë³€ê²½
    async function onPersonChange() {
      currentPerson = personSelect.value;
      selectedDates = [];
      
      if (currentPerson && supabase) {
        showStatus('loading', 'ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        try {
          const { data, error } = await supabase
            .from('votes')
            .select('selected_dates')
            .eq('person_name', currentPerson)
            .single();

          if (error) throw error;
          
          selectedDates = data?.selected_dates || [];
          showStatus('success', `${currentPerson}ë‹˜ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
          setTimeout(() => hideStatus(), 2000);
        } catch (err) {
          console.error(err);
          showStatus('error', 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
      }

      saveBtn.disabled = !currentPerson;
      renderCalendar();
    }

    // ëª¨ë“  íˆ¬í‘œ ë¡œë“œ
    async function loadAllVotes() {
      if (!supabase) return;

      try {
        const { data, error } = await supabase
          .from('votes')
          .select('person_name, selected_dates');

        if (error) throw error;

        allVotes = {};
        data.forEach(row => {
          allVotes[row.person_name] = row.selected_dates || [];
        });

        updateVoteDots();
      } catch (err) {
        console.error('íˆ¬í‘œ ë¡œë“œ ì‹¤íŒ¨:', err);
      }
    }

    // ì €ì¥
    async function saveVotes() {
      if (!currentPerson || !supabase) return;

      showStatus('loading', 'ì €ì¥ ì¤‘...');
      saveBtn.disabled = true;

      try {
        const { error } = await supabase
          .from('votes')
          .update({ 
            selected_dates: selectedDates,
            updated_at: new Date().toISOString()
          })
          .eq('person_name', currentPerson);

        if (error) throw error;

        allVotes[currentPerson] = [...selectedDates];
        showStatus('success', 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ“');
        updateVoteDots();
        
        setTimeout(() => hideStatus(), 2000);
      } catch (err) {
        console.error(err);
        showStatus('error', 'ì €ì¥ ì‹¤íŒ¨: ' + err.message);
      }

      saveBtn.disabled = false;
    }

    // ì´ˆê¸°í™”
    function resetSelection() {
      selectedDates = [];
      renderCalendar();
      if (currentPerson) {
        saveBtn.disabled = false;
      }
    }

    // ìƒíƒœ í‘œì‹œ
    function showStatus(type, message) {
      status.className = 'status ' + type;
      status.textContent = message;
      status.style.display = 'block';
    }

    function hideStatus() {
      status.style.display = 'none';
    }

    // ì‹œì‘
    init();
  </script>
</body>
</html>
